<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ±‡ç‡è½¬æ¢åˆ†æå·¥å…·</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    input, button {
      margin: 5px;
      padding: 5px;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    h2 {
      margin-top: 40px;
    }
    .summary {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>æ±‡ç‡è½¬æ¢åˆ†æå·¥å…·</h1>

  <!-- ç¾å…ƒ â†’ æ—¥å…ƒ -->
  <h2>ç¾å…ƒ â†’ æ—¥å…ƒ</h2>
  <table id="usdToJpyTable">
    <tr><th>ç¾å…ƒé‡‘é¢</th><th>ç¾å…ƒå…‘æ—¥å…ƒæ±‡ç‡</th><th>å…‘æ¢åæ—¥å…ƒ</th><th>æ“ä½œ</th></tr>
  </table>
  <button onclick="addRow('usdToJpyTable', ['usdAmount', 'usdToJpyRate'], 'usdToJpyResult', 'usdToJpy')">â• æ·»åŠ äº¤æ˜“è¡Œ</button>

  <!-- æ—¥å…ƒ â†’ ç¾å…ƒ -->
  <h2>æ—¥å…ƒ â†’ ç¾å…ƒ</h2>
  <table id="jpyToUsdTable">
    <tr><th>æ—¥å…ƒé‡‘é¢</th><th>æ—¥å…ƒå…‘ç¾å…ƒæ±‡ç‡</th><th>å…‘æ¢åç¾å…ƒ</th><th>æ“ä½œ</th></tr>
  </table>
  <button onclick="addRow('jpyToUsdTable', ['jpyAmount', 'jpyToUsdRate'], 'jpyToUsdResult', 'jpyToUsd')">â• æ·»åŠ äº¤æ˜“è¡Œ</button>

  <br><button onclick="calculateSummary()">ğŸ“Š è®¡ç®—æ±‡æ€»</button>

  <div class="summary" id="summaryResult"></div>

  <script>
    function formatNumber(num) {
      return num.toLocaleString('en-US', { maximumFractionDigits: 2 });
    }

    function addRow(tableId, inputClasses, resultClass, type) {
      const table = document.getElementById(tableId);
      const row = table.insertRow();
      inputClasses.forEach(cls => {
        const cell = row.insertCell();
        const input = document.createElement('input');
        input.type = 'number';
        input.className = cls;
        input.setAttribute('oninput', `autoCalc(this, '${type}')`);
        cell.appendChild(input);
      });
      const resultCell = row.insertCell();
      resultCell.className = resultClass;
      resultCell.textContent = '--';
      const actionCell = row.insertCell();
      actionCell.innerHTML = `<button onclick="removeRow(this)">åˆ é™¤</button>`;
    }

    function removeRow(btn) {
      const row = btn.parentNode.parentNode;
      row.parentNode.removeChild(row);
    }

    function autoCalc(input, type) {
      const row = input.closest('tr');
      let amount, rate, result;
      if (type === 'usdToJpy') {
        amount = parseFloat(row.querySelector('.usdAmount')?.value);
        rate = parseFloat(row.querySelector('.usdToJpyRate')?.value);
        result = amount * rate;
        if (!isNaN(result)) {
          row.querySelector('.usdToJpyResult').textContent = formatNumber(result);
        } else {
          row.querySelector('.usdToJpyResult').textContent = '--';
        }
      } else if (type === 'jpyToUsd') {
        amount = parseFloat(row.querySelector('.jpyAmount')?.value);
        rate = parseFloat(row.querySelector('.jpyToUsdRate')?.value);
        result = amount / rate;
        if (!isNaN(result)) {
          row.querySelector('.jpyToUsdResult').textContent = formatNumber(result);
        } else {
          row.querySelector('.jpyToUsdResult').textContent = '--';
        }
      }
    }

    function calculateSummary() {
      let usdTotal = 0, jpyFromUsdTotal = 0;
      let jpyTotal = 0, usdFromJpyTotal = 0;

      document.querySelectorAll('#usdToJpyTable tr').forEach(row => {
        const usdInput = row.querySelector('.usdAmount');
        const rateInput = row.querySelector('.usdToJpyRate');
        if (usdInput && rateInput) {
          const usd = parseFloat(usdInput.value);
          const rate = parseFloat(rateInput.value);
          if (!isNaN(usd) && !isNaN(rate)) {
            const jpy = usd * rate;
            row.querySelector('.usdToJpyResult').textContent = formatNumber(jpy);
            usdTotal += usd;
            jpyFromUsdTotal += jpy;
          }
        }
      });

      document.querySelectorAll('#jpyToUsdTable tr').forEach(row => {
        const jpyInput = row.querySelector('.jpyAmount');
        const rateInput = row.querySelector('.jpyToUsdRate');
        if (jpyInput && rateInput) {
          const jpy = parseFloat(jpyInput.value);
          const rate = parseFloat(rateInput.value);
          if (!isNaN(jpy) && !isNaN(rate)) {
            const usd = jpy / rate;
            row.querySelector('.jpyToUsdResult').textContent = formatNumber(usd);
            jpyTotal += jpy;
            usdFromJpyTotal += usd;
          }
        }
      });

      const usdProfit = usdFromJpyTotal - usdTotal;
      const usdYield = usdTotal > 0 ? (usdProfit / usdTotal) * 100 : 0;

      const jpyProfit = jpyFromUsdTotal - jpyTotal;
      const jpyYield = jpyTotal > 0 ? (jpyProfit / jpyTotal) * 100 : 0;

      document.getElementById('summaryResult').innerHTML = `
        <h3>ğŸ“ˆ æ±‡æ€»ç»“æœ</h3>
        <table>
          <tr><th>è·¯å¾„</th><th>å…‘æ¢å‰é‡‘é¢</th><th>å…‘æ¢åé‡‘é¢</th><th>æ”¶ç›Šé‡‘é¢</th><th>æ”¶ç›Šç‡</th></tr>
          <tr>
            <td>ç¾å…ƒ â†’ æ—¥å…ƒ â†’ ç¾å…ƒ</td>
            <td>${formatNumber(usdTotal)} ç¾å…ƒ</td>
            <td>${formatNumber(usdFromJpyTotal)} ç¾å…ƒ</td>
            <td>${formatNumber(usdProfit)} ç¾å…ƒ</td>
            <td>${usdYield.toFixed(2)}%</td>
          </tr>
          <tr>
            <td>æ—¥å…ƒ â†’ ç¾å…ƒ â†’ æ—¥å…ƒ</td>
            <td>${formatNumber(jpyTotal)} æ—¥å…ƒ</td>
            <td>${formatNumber(jpyFromUsdTotal)} æ—¥å…ƒ</td>
            <td>${formatNumber(jpyProfit)} æ—¥å…ƒ</td>
            <td>${jpyYield.toFixed(2)}%</td>
          </tr>
        </table>
      `;
    }
  </script>
</body>
</html>
